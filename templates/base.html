<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Hands On Master{% endblock %}</title>
  <!-- Early theme bootstrap: apply saved theme before paint to avoid FOUC -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem('theme');
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const useDark = saved === 'dark' || (!saved && prefersDark);
        const root = document.documentElement;
        root.classList.toggle('dark', useDark);
        root.setAttribute('data-theme', useDark ? 'dark' : 'light');
        root.style.colorScheme = useDark ? 'dark' : 'light';
      } catch (_) {}
    })();
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            'fade-in': 'fadeIn 0.6s ease-in-out',
            'slide-up': 'slideUp 0.8s ease-out',
            'scale-in': 'scaleIn 0.5s ease-out',
            'float': 'float 3s ease-in-out infinite',
            'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
            'progress': 'progress 2s ease-out',
            'bounce-gentle': 'bounceGentle 2s ease-in-out infinite',
            'shimmer': 'shimmer 2s ease-in-out infinite',
            'rotate-slow': 'rotateSlow 20s linear infinite',
            'gradient-x': 'gradientX 3s ease infinite',
            'slide-in-right': 'slideInRight 0.6s ease-out',
            'wiggle': 'wiggle 1s ease-in-out infinite',
          },
          keyframes: {
            fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
            slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
            scaleIn: { '0%': { opacity: '0', transform: 'scale(0.95)' }, '100%': { opacity: '1', transform: 'scale(1)' } },
            float: { '0%, 100%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-5px)' } },
            pulseGlow: { '0%, 100%': { boxShadow: '0 0 5px rgba(59, 130, 246, 0.5)' }, '50%': { boxShadow: '0 0 20px rgba(59, 130, 246, 0.8)' } },
            progress: { '0%': { width: '0%' } },
            bounceGentle: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
            shimmer: { '0%': { backgroundPosition: '-200% 0' }, '100%': { backgroundPosition: '200% 0' } },
            rotateSlow: { '0%': { transform: 'rotate(0deg)' }, '100%': { transform: 'rotate(360deg)' } },
            gradientX: { '0%, 100%': { backgroundPosition: '0% 50%' }, '50%': { backgroundPosition: '100% 50%' } },
            slideInRight: { '0%': { opacity: '0', transform: 'translateX(100px)' }, '100%': { opacity: '1', transform: 'translateX(0)' } },
            wiggle: { '0%, 100%': { transform: 'rotate(-3deg)' }, '50%': { transform: 'rotate(3deg)' } }
          },
          backgroundImage: {
            'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
            'gradient-conic': 'conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))',
            'shimmer': 'linear-gradient(110deg, transparent 40%, rgba(255,255,255,0.5) 50%, transparent 60%)',
          },
          backdropBlur: { xs: '2px' }
        },
      },
    }
  </script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-blue-900 dark:to-indigo-900 text-gray-800 dark:text-white min-h-screen">
  <!-- Enhanced Background Pattern -->
  <div class="fixed inset-0 opacity-[0.15] dark:opacity-[0.05]">
    <div class="absolute inset-0 bg-gradient-conic from-blue-400 via-purple-400 via-pink-400 to-cyan-400 animate-rotate-slow"></div>
  </div>
  <!-- Light Mode Additional Background Elements -->
  <div class="fixed inset-0 pointer-events-none opacity-30 dark:opacity-0">
    <div class="absolute top-0 left-0 w-96 h-96 bg-gradient-radial from-blue-200/40 to-transparent rounded-full blur-3xl"></div>
    <div class="absolute top-20 right-0 w-80 h-80 bg-gradient-radial from-purple-200/40 to-transparent rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-1/3 w-72 h-72 bg-gradient-radial from-pink-200/40 to-transparent rounded-full blur-3xl"></div>
    <div class="absolute bottom-20 right-20 w-64 h-64 bg-gradient-radial from-cyan-200/40 to-transparent rounded-full blur-2xl"></div>
  </div>

  <div class="flex relative z-10">
    <!-- Sidebar -->
    <aside id="sidebar" class="sticky top-0 w-16 hover:w-64 bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl h-screen transition-all duration-300 ease-in-out overflow-hidden group border-r border-gray-200/50 dark:border-gray-700/50 shadow-2xl">
      <!-- Logo/Brand Section -->
      <div class="p-3 border-b border-gray-100/50 dark:border-gray-700/50">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-gradient-to-tr from-indigo-500 via-blue-500 to-cyan-500 rounded-lg flex items-center justify-center flex-shrink-0 shadow-lg">
            <span class="text-white text-lg font-bold">H</span>
          </div>
          <div class="sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-sm font-bold text-gray-800 dark:text-white whitespace-nowrap overflow-hidden">
            <span class="bg-gradient-to-r from-indigo-600 to-cyan-600 bg-clip-text text-transparent">Hands On Master</span>
          </div>
          <!-- Pin toggle -->
          <button id="pinSidebar" title="Pin sidebar" class="ml-auto w-9 h-9 rounded-lg hover:bg-gray-100/60 dark:hover:bg-gray-700/60 flex items-center justify-center text-gray-500 dark:text-gray-300">
            <span id="pinIcon">üìå</span>
          </button>
        </div>
      </div>

      <!-- Top Section with Notifications -->
      <div class="p-3 border-b border-gray-100/50 dark:border-gray-700/50">
        <div class="flex items-center gap-3">
          <button id="notifBtn" class="relative w-10 h-10 hover:bg-gradient-to-r hover:from-amber-50 hover:to-red-50 dark:hover:bg-gradient-to-r dark:hover:from-gray-700 dark:hover:to-gray-600 rounded-lg transition-all duration-200 flex items-center justify-center group/btn flex-shrink-0 hover:scale-110 hover:shadow-lg">
            <span class="text-lg">üîî</span>
            <span class="absolute -top-1 -right-1 bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-medium shadow-lg">3</span>
          </button>
          <div class="sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-sm text-gray-700 dark:text-gray-300 font-medium whitespace-nowrap overflow-hidden">
            <span>Notifications</span>
          </div>
        </div>
      </div>

      <!-- Navigation Menu -->
      <nav class="flex-1 py-4 px-2" id="sidebarNav">
        <div class="space-y-1">
          <a href="/dashboard" data-path="/dashboard" class="nav-link flex items-center gap-3 px-3 py-3 rounded-xl transition-all duration-300 text-gray-700 dark:text-gray-300 whitespace-nowrap group/item hover:scale-105 hover:shadow-lg">
            <span class="text-lg flex-shrink-0">üè†</span>
            <span class="nav-label sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-sm">Dashboard</span>
          </a>
          <a href="/learning-paths" data-path="/learning-paths" class="nav-link flex items-center gap-3 px-3 py-3 rounded-xl transition-all duration-300 text-gray-700 dark:text-gray-300 whitespace-nowrap group/item hover:scale-105 hover:shadow-lg">
            <span class="text-lg flex-shrink-0">üõ§Ô∏è</span>
            <span class="nav-label sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-sm">Learning Path</span>
          </a>
          <a href="/challenges" data-path="/challenges" class="nav-link flex items-center gap-3 px-3 py-3 rounded-xl transition-all duration-300 text-gray-700 dark:text-gray-300 whitespace-nowrap group/item hover:scale-105 hover:shadow-lg">
            <span class="text-lg flex-shrink-0">üèÜ</span>
            <span class="nav-label sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-sm">Challenges</span>
          </a>
          <a href="/ai-tutor" data-path="/ai-tutor" class="nav-link flex items-center gap-3 px-3 py-3 rounded-xl transition-all duration-300 text-gray-700 dark:text-gray-300 whitespace-nowrap group/item hover:scale-105 hover:shadow-lg">
            <span class="text-lg flex-shrink-0">ü§ñ</span>
            <span class="nav-label sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-sm">AI Tutor</span>
          </a>
          <a href="/leaderboard" data-path="/leaderboard" class="nav-link flex items-center gap-3 px-3 py-3 rounded-xl transition-all duration-300 text-gray-700 dark:text-gray-300 whitespace-nowrap group/item hover:scale-105 hover:shadow-lg">
            <span class="text-lg flex-shrink-0">üìä</span>
            <span class="nav-label sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-sm">Leaderboard</span>
          </a>
        </div>
      </nav>

      <!-- Bottom Section -->
      <div class="border-t border-gray-100/50 dark:border-gray-700/50 p-3 space-y-3">
        <!-- Theme Toggle -->
        <div class="flex items-center gap-3 group/theme">
          <button id="themeToggle" class="w-10 h-10 hover:bg-gradient-to-r hover:from-amber-50 hover:to-orange-50 dark:hover:from-gray-700 dark:hover:to-gray-600 rounded-lg transition-all duration-300 flex items-center justify-center group/btn flex-shrink-0 hover:scale-110 hover:shadow-lg">
            <span class="text-lg">üåì</span>
          </button>
          <div class="sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-xs text-gray-600 dark:text-gray-400 font-medium whitespace-nowrap overflow-hidden">
            <span class="bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent">Dark Mode</span>
          </div>
        </div>
        <!-- Profile Section -->
        <div class="flex items-center gap-3 group/profile relative">
          <button id="profileBtn" class="w-10 h-10 hover:bg-gradient-to-r hover:from-violet-50 hover:to-purple-50 dark:hover:from-gray-700 dark:hover:to-gray-600 rounded-lg transition-all duration-300 flex items-center justify-center group/btn flex-shrink-0 hover:scale-110 hover:shadow-lg">
            <div class="w-10 h-10 bg-gradient-to-br from-violet-500 via-purple-500 to-fuchsia-500 rounded-lg flex items-center justify-center flex-shrink-0 shadow-sm">
              <span class="text-white text-sm font-medium">D</span>
            </div>
          </button>
          <div class="sidebar-label opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-xs text-gray-600 dark:text-gray-400 font-medium whitespace-nowrap overflow-hidden">
            <span class="bg-gradient-to-r from-violet-600 to-fuchsia-600 bg-clip-text text-transparent">Profile</span>
          </div>
          <div id="profileMenu" class="hidden absolute bottom-full left-0 mb-2 w-48 bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl shadow-2xl rounded-xl border border-gray-200/50 dark:border-gray-600/50 overflow-hidden z-50 animate-scale-in">
            <div class="px-4 py-3 border-b border-gray-100/50 dark:border-gray-700/50 bg-gradient-to-r from-blue-50/30 to-purple-50/30 dark:from-blue-900/20 dark:to-purple-900/20">
              <div class="text-sm font-semibold text-gray-900 dark:text-white">Dinesh Kumar</div>
              <div class="text-xs text-gray-500 dark:text-gray-400">dinesh@example.com</div>
            </div>
            <a href="#" class="flex items-center gap-3 px-4 py-3 hover:bg-gradient-to-r hover:from-blue-50/50 hover:to-purple-50/50 dark:hover:from-gray-700/50 dark:hover:to-gray-600/50 transition-all duration-200 hover:scale-[1.02] group">
              <span class="text-gray-400">üë§</span>
              <span class="text-sm">Account</span>
            </a>
            <a href="#" class="flex items-center gap-3 px-4 py-3 hover:bg-gradient-to-r hover:from-blue-50/50 hover:to-purple-50/50 dark:hover:from-gray-700/50 dark:hover:to-gray-600/50 transition-all duration-200 hover:scale-[1.02] group">
              <span class="text-gray-400">‚öôÔ∏è</span>
              <span class="text-sm">Settings</span>
            </a>
            <hr class="border-gray-100/50 dark:border-gray-700/50">
            <a href="/login?mode=login" class="flex items-center gap-3 px-4 py-3 hover:bg-gradient-to-r hover:from-red-50/50 hover:to-pink-50/50 dark:hover:from-red-900/20 dark:hover:to-pink-900/20 transition-all duration-200 text-red-600 dark:text-red-400 hover:scale-[1.02] group">
              <span>üö™</span>
              <span class="text-sm">Sign Out</span>
            </a>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 space-y-8 relative">
      <!-- Floating particles effect -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-10 left-10 w-2 h-2 bg-blue-400 rounded-full animate-float opacity-20"></div>
        <div class="absolute top-32 right-20 w-1 h-1 bg-purple-400 rounded-full animate-bounce-gentle opacity-30" style="animation-delay: 1s"></div>
        <div class="absolute bottom-20 left-1/4 w-1.5 h-1.5 bg-pink-400 rounded-full animate-float opacity-25" style="animation-delay: 2s"></div>
        <div class="absolute top-1/2 right-10 w-1 h-1 bg-indigo-400 rounded-full animate-bounce-gentle opacity-20" style="animation-delay: 0.5s"></div>
      </div>

      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- JavaScript -->
  <script>
    // Profile menu toggle
    document.getElementById('profileBtn').addEventListener('click', () => {
      document.getElementById('profileMenu').classList.toggle('hidden');
    });

    // Theme toggle
    document.getElementById('themeToggle').addEventListener('click', () => {
      const root = document.documentElement;
      const isDark = root.classList.toggle('dark');
      const theme = isDark ? 'dark' : 'light';
      root.setAttribute('data-theme', theme);
      root.style.colorScheme = theme;
      try { localStorage.setItem('theme', theme); } catch (_) {}
    });

    // Close profile menu when clicking outside
    document.addEventListener('click', (e) => {
      const profileBtn = document.getElementById('profileBtn');
      const profileMenu = document.getElementById('profileMenu');
      if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
        profileMenu.classList.add('hidden');
      }
    });

    // Sidebar active link and pinning
    (function() {
      const ACTIVE_CLASSES = 'bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/50 dark:to-blue-900/50 text-indigo-700 dark:text-indigo-300 font-medium border border-indigo-200/50 dark:border-indigo-700/50 shadow-lg';
      const links = document.querySelectorAll('#sidebarNav .nav-link');
      const path = window.location.pathname;
      links.forEach(a => {
        if (a.dataset.path === path) {
          a.classList.add(...ACTIVE_CLASSES.split(' '));
        }
      });

      const sidebar = document.getElementById('sidebar');
      const pinBtn = document.getElementById('pinSidebar');
      const pinIcon = document.getElementById('pinIcon');
      const LS_KEY = 'sidebarPinned';

      function applyPinState(pinned) {
        if (pinned) {
          sidebar.classList.remove('w-16');
          sidebar.classList.add('w-64');
          pinIcon.textContent = 'üìç';
          // Show labels when pinned
          document.querySelectorAll('#sidebar .sidebar-label').forEach((el) => {
            el.classList.add('opacity-100');
            el.classList.remove('opacity-0');
            el.classList.remove('group-hover:opacity-100');
          });
        } else {
          sidebar.classList.add('w-16');
          sidebar.classList.remove('w-64');
          pinIcon.textContent = 'üìå';
          // Restore hover-only labels when unpinned
          document.querySelectorAll('#sidebar .sidebar-label').forEach((el) => {
            el.classList.remove('opacity-100');
            el.classList.add('opacity-0');
            el.classList.add('group-hover:opacity-100');
          });
        }
      }

      const stored = localStorage.getItem(LS_KEY);
      const initialPinned = stored === 'true';
      applyPinState(initialPinned);

      pinBtn.addEventListener('click', () => {
        const curr = localStorage.getItem(LS_KEY) === 'true';
        localStorage.setItem(LS_KEY, (!curr).toString());
        applyPinState(!curr);
      });
    })();
  </script>
</body>
</html>
